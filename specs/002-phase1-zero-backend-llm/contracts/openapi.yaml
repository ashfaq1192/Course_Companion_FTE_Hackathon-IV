openapi: 3.0.3
info:
  title: Course Companion FTE - Phase 1 API
  description: API for the Zero-Backend-LLM ChatGPT App backend
  version: 1.0.0
  contact:
    name: Course Companion FTE Team
    email: support@coursecompanionfte.example.com

servers:
  - url: https://api.coursecompanionfte.example.com/v1
    description: Production server
  - url: https://staging-api.coursecompanionfte.example.com/v1
    description: Staging server

tags:
  - name: Authentication
    description: User authentication endpoints
  - name: Content
    description: Course content management
  - name: Progress
    description: User progress tracking
  - name: Quiz
    description: Quiz functionality
  - name: Subscriptions
    description: Subscription management

paths:
  /auth/login:
    post:
      tags:
        - Authentication
      summary: Authenticate user and return JWT token
      description: Authenticates a user with email and password, returning an access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: "student@example.com"
                password:
                  type: string
                  format: password
                  example: "securePassword123"
      responses:
        '200':
          description: Successful authentication
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  token_type:
                    type: string
                    example: "bearer"
        '401':
          description: Invalid credentials
        '422':
          description: Validation error

  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Creates a new user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - full_name
              properties:
                email:
                  type: string
                  format: email
                  example: "student@example.com"
                password:
                  type: string
                  format: password
                  example: "securePassword123"
                full_name:
                  type: string
                  example: "John Doe"
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    example: "123e4567-e89b-12d3-a456-426614174000"
                  email:
                    type: string
                    format: email
                    example: "student@example.com"
                  full_name:
                    type: string
                    example: "John Doe"
        '400':
          description: User already exists
        '422':
          description: Validation error

  /content/{content_id}:
    get:
      tags:
        - Content
      summary: Retrieve specific course content
      description: Retrieves course content by its ID
      parameters:
        - name: content_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: "123e4567-e89b-12d3-a456-426614174000"
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Course content retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CourseContent'
        '401':
          description: Unauthorized
        '403':
          description: Access denied (freemium restriction)
        '404':
          description: Content not found

  /content/by-course/{course_id}:
    get:
      tags:
        - Content
      summary: Retrieve all content for a course
      description: Retrieves all content for a specific course, ordered by chapter and section
      parameters:
        - name: course_id
          in: path
          required: true
          schema:
            type: string
            example: "intro-to-python"
        - name: skip
          in: query
          required: false
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            maximum: 100
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Course content retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/CourseContent'
                  total:
                    type: integer
                  skip:
                    type: integer
                  limit:
                    type: integer
        '401':
          description: Unauthorized
        '403':
          description: Access denied (freemium restriction)

  /content/search:
    get:
      tags:
        - Content
      summary: Search course content
      description: Searches course content by keywords
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            example: "variable declaration"
        - name: course_id
          in: query
          required: false
          schema:
            type: string
            example: "intro-to-python"
        - name: skip
          in: query
          required: false
          schema:
            type: integer
            default: 0
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 10
            maximum: 50
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Search results retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/CourseContent'
                  total:
                    type: integer
                  skip:
                    type: integer
                  limit:
                    type: integer
        '401':
          description: Unauthorized

  /progress/{content_id}:
    get:
      tags:
        - Progress
      summary: Get user progress for specific content
      description: Retrieves the user's progress for a specific piece of content
      parameters:
        - name: content_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: "123e4567-e89b-12d3-a456-426614174000"
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Progress retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProgressRecord'
        '401':
          description: Unauthorized
        '404':
          description: Progress record not found
    put:
      tags:
        - Progress
      summary: Update user progress for specific content
      description: Updates the user's progress for a specific piece of content
      parameters:
        - name: content_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: "123e4567-e89b-12d3-a456-426614174000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [not_started, in_progress, completed]
                completion_percentage:
                  type: number
                  minimum: 0
                  maximum: 100
                time_spent_seconds:
                  type: integer
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Progress updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProgressRecord'
        '401':
          description: Unauthorized
        '422':
          description: Validation error

  /progress/user/{user_id}:
    get:
      tags:
        - Progress
      summary: Get all progress for a user
      description: Retrieves all progress records for a specific user
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: "123e4567-e89b-12d3-a456-426614174000"
        - name: course_id
          in: query
          required: false
          schema:
            type: string
            example: "intro-to-python"
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Progress records retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProgressRecord'
        '401':
          description: Unauthorized

  /quiz/{content_id}/start:
    post:
      tags:
        - Quiz
      summary: Start a quiz
      description: Initializes a quiz attempt for the user
      parameters:
        - name: content_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: "123e4567-e89b-12d3-a456-426614174000"
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Quiz started successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuizAttempt'
        '401':
          description: Unauthorized
        '403':
          description: Access denied (freemium restriction)
        '404':
          description: Quiz content not found

  /quiz/{content_id}/submit:
    post:
      tags:
        - Quiz
      summary: Submit quiz answers
      description: Submits answers for a quiz and receives grading
      parameters:
        - name: content_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: "123e4567-e89b-12d3-a456-426614174000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - answers
              properties:
                answers:
                  type: array
                  items:
                    type: object
                    required:
                      - question_id
                      - answer
                    properties:
                      question_id:
                        type: string
                        format: uuid
                      answer:
                        type: string
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Quiz submitted and graded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GradedQuiz'
        '401':
          description: Unauthorized
        '403':
          description: Access denied (freemium restriction)
        '404':
          description: Quiz content not found

  /quiz/attempts/{attempt_id}:
    get:
      tags:
        - Quiz
      summary: Get quiz attempt details
      description: Retrieves details of a specific quiz attempt
      parameters:
        - name: attempt_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: "123e4567-e89b-12d3-a456-426614174000"
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Quiz attempt retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GradedQuiz'
        '401':
          description: Unauthorized
        '404':
          description: Quiz attempt not found

  /subscriptions/current:
    get:
      tags:
        - Subscriptions
      summary: Get current user's subscription
      description: Retrieves the current user's subscription information
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Subscription retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '401':
          description: Unauthorized
        '404':
          description: No subscription found

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    CourseContent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        content_type:
          type: string
          enum: [text, video, quiz, exercise]
        content_data:
          type: string
        course_id:
          type: string
        chapter_number:
          type: integer
        section_number:
          type: integer
        is_available:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ProgressRecord:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        content_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [not_started, in_progress, completed]
        completion_percentage:
          type: number
          minimum: 0
          maximum: 100
        time_spent_seconds:
          type: integer
        last_accessed_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    QuizQuestion:
      type: object
      properties:
        id:
          type: string
          format: uuid
        content_id:
          type: string
          format: uuid
        question_text:
          type: string
        question_type:
          type: string
          enum: [multiple_choice, true_false, short_answer]
        options:
          type: array
          items:
            type: string
        correct_answer:
          type: string
        explanation:
          type: string
        difficulty_level:
          type: string
          enum: [easy, medium, hard]

    QuizAttempt:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        content_id:
          type: string
          format: uuid
        score:
          type: number
          minimum: 0
          maximum: 100
        total_questions:
          type: integer
        correct_answers:
          type: integer
        attempt_date:
          type: string
          format: date-time
        time_taken_seconds:
          type: integer
        answers:
          type: array
          items:
            type: object
            properties:
              question_id:
                type: string
                format: uuid
              answer:
                type: string

    GradedQuiz:
      type: object
      properties:
        attempt:
          $ref: '#/components/schemas/QuizAttempt'
        questions:
          type: array
          items:
            $ref: '#/components/schemas/QuizQuestion'
        results:
          type: array
          items:
            type: object
            properties:
              question_id:
                type: string
                format: uuid
              user_answer:
                type: string
              is_correct:
                type: boolean
              explanation:
                type: string

    Subscription:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        subscription_type:
          type: string
          enum: [free, premium]
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        is_active:
          type: boolean
        payment_status:
          type: string
          enum: [pending, paid, failed]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

  responses:
    UnauthorizedError:
      description: Access token is missing or invalid
    ValidationError:
      description: Request validation failed
      content:
        application/json:
          schema:
            type: object
            properties:
              detail:
                type: string